#!/bin/true
FLEX_VERSION=2.6.4

set -e

. lib/env.sh
. lib/functions.sh
. targets/${STRAP_SELECTED_TARGET}.tgt

cd ${STRAP_BUILD_DIR}

extract_source_pkg flex

cd ${STRAP_BUILD_DIR}/flex

copy_local_build_stage3

export CHROOT_CD=/build/flex

msg "Configuring flex..."

run_cmd_chroot_stage3 "./configure ./configure --prefix=/usr --docdir=/usr/share/doc/flex-${FLEX_VERSION}"

msg "Building flex..."

run_cmd_chroot_stage3 "make -j${STRAP_PJOBS}"

msg "Install flex..."

run_cmd_chroot_stage3 "make -j${STRAP_PJOBS} install"

msg "Install flex compat link..."

ln -sv flex ${STRAP_STAGE3_INSTALL_DIR}/usr/bin/lex