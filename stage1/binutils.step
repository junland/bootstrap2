#!/bin/true

. lib/env.sh
. lib/functions.sh
. targets/${STRAP_SELECTED_TARGET}.tgt

cd ${STRAP_BUILD_DIR}

extract_source_pkg binutils

cd ${STRAP_BUILD_DIR}/binutils-*

mkdir -p binutils-build && cd binutils-build

msg "Configuring binutils..."

../configure $STRAP_TARGET_BINUTILOPTS \
	--prefix=$STRAP_STAGE1_INSTALL_DIR \
    --build=$STRAP_HOST \
    --host=$STRAP_HOST \
    --target=$STRAP_TARGET \
    --with-sysroot=$STRAP_STAGE1_INSTALL_DIR/sysroot \
    --with-pic \
	--with-system-zlib \
    --enable-default-hash-style=gnu \
	--enable-64-bit-bfd \
	--enable-deterministic-archives \
	--enable-gold \
	--enable-ld=default \
	--enable-lto \
	--enable-plugins \
	--enable-relro \
	--enable-threads \
    --disable-nls \
	--disable-werror \
    --disable-multilib 

msg "Configuring host for binutils..."

make MAKEINFO=true configure-host

msg "Building binutils..."

make -j${STRAP_PJOBS} MAKEINFO=true all

msg "Install binutils..."

make -j${STRAP_PJOBS} MAKEINFO=true install