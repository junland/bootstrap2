#!/bin/true

set -e

. lib/env.sh
. lib/functions.sh
. targets/${STRAP_SELECTED_TARGET}.tgt

cd ${STRAP_BUILD_DIR}

extract_source_pkg pkgconf

cd ${STRAP_BUILD_DIR}/pkgconf-*

msg "Configuring pkgconf..."

./configure \
    --prefix=/usr \
    --build=$STRAP_HOST \
    --host=$STRAP_HOST \
    --libdir=/usr/lib \
    --bindir=/usr/bin \
    --with-system-libdir=/usr/lib \
    --with-system-includedir=/usr/include \
    --includedir=/usr/include \
    --enable-static \
    --disable-shared

msg "Building pkgconf..."

make -j${STRAP_PJOBS}

msg "Install pkgconf..."

make -j${STRAP_PJOBS} DESTDIR="${STRAP_STAGE1_INSTALL_DIR}" install

msg "Setting pkgconf symlinks..."

ln -svf "${STRAP_STAGE1_INSTALL_DIR}"/usr/bin/pkgconf "${STRAP_STAGE1_INSTALL_DIR}"/bin/pkg-config
ln -svf "${STRAP_STAGE1_INSTALL_DIR}"/usr/bin/pkgconf "${STRAP_STAGE1_INSTALL_DIR}"/bin/pkgconf
ln -svf "${STRAP_STAGE1_INSTALL_DIR}"/usr/bin/pkgconf "${STRAP_STAGE1_INSTALL_DIR}"/bin/$STRAP_TARGET-pkg-config
ln -svf "${STRAP_STAGE1_INSTALL_DIR}"/usr/bin/pkgconf "${STRAP_STAGE1_INSTALL_DIR}"/bin/$STRAP_TARGET-pkgconf
