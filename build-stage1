#/usr/bin/env -S -i bash --norc --noprofile

set -e

. lib/env.sh
. lib/functions.sh
. targets/${STRAP_SELECTED_TARGET}.tgt

check_target && download_sources && setup_dirs_stage1

STEPS=(sysroot linux-headers binutils gcc-minimal glibc gcc-final pkgconf)

for step in ${STEPS[@]} ; do
    clean_build_dir
    msg "Building $step for stage1 targeting $STRAP_SELECTED_TARGET"
    env -S -i STRAP_SELECTED_TARGET="${STRAP_SELECTED_TARGET}" bash --norc --noprofile "stage1/${step}.step" || msg_fail "Building ${step} failed for stage1"
done

msg "Stage1 complete!"